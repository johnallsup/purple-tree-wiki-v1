<!DOCTYPE html>
<html>
<meta charset='utf8'/>
<title>Wiki WIKI_SUBDIR - WIKI_WORD</title>
<link rel="icon" type="image/x-icon" href="/purple_tree_wiki_favicon.png"/>
<link rel="stylesheet" href="style.css"/>
<link rel="stylesheet" href="lstyle.css"/>
<link rel="stylesheet" href="a11y-dark.css"/>
<script src="highlight.min.js"></script>
<script>
const keys = { }
window.addEventListener('load', _ => {
  const qq = x => Array.from(document.querySelectorAll(x))
  const links_with_keys = qq("a[shortcut]")
  links_with_keys.forEach(link => {
    const shortcut = link.getAttribute("shortcut")
    if( ! shortcut.match(/^[a-z0-9]/) ) {
      return console.log(`Invalid shortcut ${shortcut} for link ${link}`)
    }
    keys[shortcut] = link.textContent.split("[")[0]
  })
  keys['v'] = undefined
  keys['h'] = "HomePage"
})
window.addEventListener('keydown', e => {
  const q = x => document.querySelector(x)
  if( e.ctrlKey || e.altKey ) {
    return true
  }
  if( e.code === "Backquote" && e.shiftKey) {
    e.preventDefault()
    const [ uri, query_string ] = window.location.href.split("?",2)
    const map = new Map()
    map.set('action','edit')
    if( query_string ) {
      const args = query_string.split("&")
      args.forEach(arg => {
        const [ k, v ] = arg.split("=",2)
        map.set(k,v)
      })
    }
    const new_query_array = []
    map.forEach(console.log)
    map.forEach((v,k) => new_query_array.push(`${k}=${v}`))
    const new_query_string = new_query_array.join("&")
    // strip off query string, if any version is specified
    // we want to pass this to edit
    const new_uri = `${uri}?${new_query_string}`
    // check for version= in query string and pass that to edit
    // we need to pass version to action=edit when saving too.
    // we 
    window.location.href = new_uri
  } else if(e.key === "v") {
    const new_uri = q('#versions_link').getAttribute('href')
    window.location.href = new_uri
  } else if(keys[e.key]) {
    window.location.href = keys[e.key]
  }
})
hljs.highlightAll()
</script>
</head>
<body>
<div id='content'>
  <h1><span class='subdir'>WIKI_SUBDIR:</span> WIKI_WORD</h1>
  NAVBAR
  <hr />
WIKI_PAGE_BODY
</div>
<footer>
<a href='http://thepurpletree.uk/'>The Purple Tree</a> 2022<br/>
Press shift-` to edit/save. Previous <a id='versions_link' href='WIKI_WORD?action=versions'>versions</a>.
</footer>
</body>
</html>
